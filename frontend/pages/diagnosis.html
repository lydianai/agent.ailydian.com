<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnosis | MEDIAN AGENT</title>
    <link rel="stylesheet" href="../static/css/dashboard.css">
    <link rel="stylesheet" href="../static/css/diagnosis.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Development Banner -->
    <div class="dev-banner">
        <i class="fas fa-code"></i>
        <span data-tr="Geliştirme Modu - Bazı özellikler beta aşamasında" data-en="Development Mode - Some features may be in beta">Geliştirme Modu</span>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle Menu">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-hospital"></i>
                </div>
                <div class="logo-text">
                    <div class="logo-main">MEDIAN AGENT</div>
                    <div class="logo-tagline">Lydian</div>
                </div>
            </div>
            <button class="sidebar-close" id="sidebarClose" aria-label="Close Menu">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <ul class="sidebar-menu">
            <li>
                <a href="dashboard.html">
                    <i class="fas fa-chart-line"></i>
                    <span data-tr="Dashboard" data-en="Dashboard">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="agents.html">
                    <i class="fas fa-robot"></i>
                    <span data-tr="Task Agentlar" data-en="Task Agents">Task Agentlar</span>
                </a>
            </li>
            <li>
                <a href="emergency.html">
                    <i class="fas fa-ambulance"></i>
                    <span data-tr="Acil Servis" data-en="Emergency">Acil Servis</span>
                </a>
            </li>
            <li class="active">
                <a href="diagnosis.html">
                    <i class="fas fa-stethoscope"></i>
                    <span data-tr="Tanı Asistanı" data-en="Diagnosis">Tanı Asistanı</span>
                </a>
            </li>
            <li>
                <a href="treatment.html">
                    <i class="fas fa-notes-medical"></i>
                    <span data-tr="Tedavi Planlama" data-en="Treatment">Tedavi Planlama</span>
                </a>
            </li>
            <li>
                <a href="pharmacy.html">
                    <i class="fas fa-pills"></i>
                    <span data-tr="Eczane" data-en="Pharmacy">Eczane</span>
                </a>
            </li>
            <li>
                <a href="patients.html">
                    <i class="fas fa-users"></i>
                    <span data-tr="Hastalar" data-en="Patients">Hastalar</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-footer">
            <a href="#" class="user-profile">
                <i class="fas fa-user-circle"></i>
                <span>Dr. Admin</span>
            </a>
            <a href="#" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span data-tr="Çıkış" data-en="Logout">Çıkış</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="page-header">
            <h1 data-tr="AI Tanı Asistanı" data-en="AI Diagnosis Assistant"><i class="fas fa-stethoscope"></i> AI Tanı Asistanı</h1>
            <div class="header-actions">
                <button class="logic-btn" id="logicBtn" style="background: linear-gradient(135deg, #ff0033 0%, #ff3366 100%); border: none; color: white; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-right: 15px;">
                    <i class="fas fa-brain"></i>
                    <span data-tr="Çalışma Mantığı" data-en="Working Logic">Çalışma Mantığı</span>
                </button>
                <div class="lang-switch">
                    <button class="lang-btn active" data-lang="tr">TR</button>
                    <button class="lang-btn" data-lang="en">EN</button>
                </div>
                <button class="notification-btn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">2</span>
                </button>
            </div>
        </header>

        <!-- Diagnosis Stats -->
        <section class="diagnosis-stats">
            <div class="stat-card stat-card-primary">
                <div class="stat-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="stat-content">
                    <h3>AI Diagnoses Today</h3>
                    <p class="stat-number">87</p>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> 15.3%
                    </span>
                </div>
            </div>

            <div class="stat-card stat-card-success">
                <div class="stat-icon">
                    <i class="fas fa-check-double"></i>
                </div>
                <div class="stat-content">
                    <h3>Accuracy Rate</h3>
                    <p class="stat-number">96.8%</p>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> 2.1%
                    </span>
                </div>
            </div>

            <div class="stat-card stat-card-info">
                <div class="stat-icon">
                    <i class="fas fa-x-ray"></i>
                </div>
                <div class="stat-content">
                    <h3>Images Analyzed</h3>
                    <p class="stat-number">234</p>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> 18.7%
                    </span>
                </div>
            </div>

            <div class="stat-card stat-card-warning">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <h3>Avg Processing Time</h3>
                    <p class="stat-number">3.2s</p>
                    <span class="stat-change negative">
                        <i class="fas fa-arrow-down"></i> 12%
                    </span>
                </div>
            </div>
        </section>

        <!-- Diagnosis Form -->
        <section class="diagnosis-section">
            <div class="diagnosis-form-container">
                <div class="section-header">
                    <h2><i class="fas fa-file-medical"></i> New Diagnostic Analysis</h2>
                    <button class="btn-primary" id="clearDiagnosisForm">
                        <i class="fas fa-redo"></i> Clear
                    </button>
                </div>

                <form id="diagnosisForm" class="diagnosis-form">
                    <!-- Patient Information -->
                    <div class="form-section">
                        <h3>Patient Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="patientId">Patient ID *</label>
                                <input type="text" id="patientId" name="patientId" placeholder="P-XXXX" required>
                            </div>
                            <div class="form-group">
                                <label for="patientAge">Age</label>
                                <input type="number" id="patientAge" name="patientAge" placeholder="35">
                            </div>
                            <div class="form-group">
                                <label for="patientGender">Gender</label>
                                <select id="patientGender" name="patientGender">
                                    <option value="">Select...</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Clinical Data -->
                    <div class="form-section">
                        <h3>Clinical Presentation</h3>
                        <div class="form-group">
                            <label for="clinicalSymptoms">Presenting Symptoms *</label>
                            <textarea id="clinicalSymptoms" name="clinicalSymptoms" rows="3" placeholder="Describe patient symptoms, duration, severity..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="medicalHistory">Medical History</label>
                            <textarea id="medicalHistory" name="medicalHistory" rows="2" placeholder="Previous conditions, surgeries, medications..."></textarea>
                        </div>
                    </div>

                    <!-- Medical Imaging -->
                    <div class="form-section">
                        <h3>Medical Imaging</h3>
                        <div class="imaging-upload-container">
                            <div class="upload-area" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h4>Upload Medical Images</h4>
                                <p>Drag & drop files here or click to browse</p>
                                <p class="upload-info">Supported: X-Ray, CT, MRI, Ultrasound (JPG, PNG, DICOM)</p>
                                <input type="file" id="imageUpload" accept="image/*,.dcm" multiple hidden>
                                <button type="button" class="btn-upload" id="browseBtn">
                                    <i class="fas fa-folder-open"></i> Browse Files
                                </button>
                            </div>
                            <div class="uploaded-images" id="uploadedImages"></div>
                        </div>

                        <div class="form-grid" style="margin-top: 20px;">
                            <div class="form-group">
                                <label for="imagingType">Imaging Type</label>
                                <select id="imagingType" name="imagingType">
                                    <option value="">Select modality...</option>
                                    <option value="x_ray">X-Ray</option>
                                    <option value="ct">CT Scan</option>
                                    <option value="mri">MRI</option>
                                    <option value="ultrasound">Ultrasound</option>
                                    <option value="pet">PET Scan</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="bodyRegion">Body Region</label>
                                <select id="bodyRegion" name="bodyRegion">
                                    <option value="">Select region...</option>
                                    <option value="head">Head/Brain</option>
                                    <option value="chest">Chest</option>
                                    <option value="abdomen">Abdomen</option>
                                    <option value="pelvis">Pelvis</option>
                                    <option value="spine">Spine</option>
                                    <option value="extremities">Extremities</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="imagingDate">Imaging Date</label>
                                <input type="date" id="imagingDate" name="imagingDate">
                            </div>
                        </div>
                    </div>

                    <!-- Laboratory Results -->
                    <div class="form-section">
                        <h3>Laboratory Results (Optional)</h3>
                        <div class="lab-results-grid">
                            <div class="form-group">
                                <label for="wbc">WBC (4.5-11.0 K/μL)</label>
                                <input type="number" step="0.1" id="wbc" name="wbc" placeholder="7.5">
                            </div>
                            <div class="form-group">
                                <label for="hemoglobin">Hemoglobin (12-16 g/dL)</label>
                                <input type="number" step="0.1" id="hemoglobin" name="hemoglobin" placeholder="14.0">
                            </div>
                            <div class="form-group">
                                <label for="platelets">Platelets (150-400 K/μL)</label>
                                <input type="number" id="platelets" name="platelets" placeholder="250">
                            </div>
                            <div class="form-group">
                                <label for="glucose">Glucose (70-100 mg/dL)</label>
                                <input type="number" id="glucose" name="glucose" placeholder="90">
                            </div>
                            <div class="form-group">
                                <label for="creatinine">Creatinine (0.6-1.2 mg/dL)</label>
                                <input type="number" step="0.1" id="creatinine" name="creatinine" placeholder="1.0">
                            </div>
                            <div class="form-group">
                                <label for="troponin">Troponin (ng/mL)</label>
                                <input type="number" step="0.01" id="troponin" name="troponin" placeholder="0.00">
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions">
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-brain"></i> Analyze with AI
                        </button>
                    </div>
                </form>
            </div>

            <!-- Diagnosis Result -->
            <div class="diagnosis-result-container" id="diagnosisResult" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-clipboard-check"></i> AI Diagnosis Report</h2>
                    <div class="result-actions">
                        <button class="btn-secondary" id="exportPDF">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                        <button class="btn-primary" id="newDiagnosis">
                            <i class="fas fa-plus"></i> New Analysis
                        </button>
                    </div>
                </div>

                <div class="result-content">
                    <!-- Confidence Score -->
                    <div class="confidence-container">
                        <div class="confidence-badge">
                            <div class="confidence-label">Confidence Score</div>
                            <div class="confidence-value" id="confidenceValue">--</div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" id="confidenceFill"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Primary Diagnosis -->
                    <div class="primary-diagnosis">
                        <h3><i class="fas fa-star"></i> Primary Diagnosis</h3>
                        <div class="diagnosis-card primary">
                            <div class="diagnosis-header">
                                <h4 id="primaryDiagnosisName">-</h4>
                                <span class="icd-code" id="primaryICD">-</span>
                            </div>
                            <p class="diagnosis-description" id="primaryDescription">-</p>
                            <div class="diagnosis-meta">
                                <span class="severity" id="primarySeverity">-</span>
                                <span class="confidence" id="primaryConfidence">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Differential Diagnosis -->
                    <div class="differential-diagnosis">
                        <h3><i class="fas fa-list"></i> Differential Diagnosis</h3>
                        <div id="differentialList" class="differential-list"></div>
                    </div>

                    <!-- Imaging Analysis -->
                    <div class="imaging-analysis" id="imagingAnalysis" style="display: none;">
                        <h3><i class="fas fa-x-ray"></i> Imaging Findings</h3>
                        <div class="imaging-grid">
                            <div class="imaging-preview" id="analyzedImagePreview"></div>
                            <div class="imaging-findings" id="imagingFindings"></div>
                        </div>
                    </div>

                    <!-- Clinical Reasoning -->
                    <div class="clinical-reasoning">
                        <h3><i class="fas fa-brain"></i> Clinical Reasoning</h3>
                        <div class="reasoning-content" id="reasoningContent">
                            <p>-</p>
                        </div>
                    </div>

                    <!-- Recommendations -->
                    <div class="recommendations">
                        <h3><i class="fas fa-notes-medical"></i> Recommendations</h3>
                        <div class="recommendations-grid">
                            <div class="recommendation-card">
                                <h4><i class="fas fa-vial"></i> Additional Tests</h4>
                                <ul id="recommendedTests"></ul>
                            </div>
                            <div class="recommendation-card">
                                <h4><i class="fas fa-user-md"></i> Specialist Referral</h4>
                                <ul id="specialistReferrals"></ul>
                            </div>
                            <div class="recommendation-card">
                                <h4><i class="fas fa-exclamation-triangle"></i> Follow-up</h4>
                                <ul id="followupActions"></ul>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Stratification -->
                    <div class="risk-stratification">
                        <h3><i class="fas fa-chart-line"></i> Risk Stratification</h3>
                        <div class="risk-grid">
                            <div class="risk-item">
                                <span class="risk-label">Mortality Risk</span>
                                <span class="risk-value" id="mortalityRisk">-</span>
                            </div>
                            <div class="risk-item">
                                <span class="risk-label">Complication Risk</span>
                                <span class="risk-value" id="complicationRisk">-</span>
                            </div>
                            <div class="risk-item">
                                <span class="risk-label">Urgency Level</span>
                                <span class="risk-value" id="urgencyLevel">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Diagnoses -->
        <section class="recent-diagnoses">
            <h2><i class="fas fa-history"></i> Recent AI Diagnoses</h2>
            <div class="diagnoses-table-container">
                <table class="diagnoses-table">
                    <thead>
                        <tr>
                            <th>Patient ID</th>
                            <th>Diagnosis</th>
                            <th>ICD-10</th>
                            <th>Confidence</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>P-1023</strong></td>
                            <td>Community-Acquired Pneumonia</td>
                            <td><span class="icd-badge">J18.9</span></td>
                            <td><span class="confidence-badge high">94.3%</span></td>
                            <td>2024-01-15 14:32</td>
                            <td>
                                <button class="btn-table-action"><i class="fas fa-eye"></i></button>
                                <button class="btn-table-action"><i class="fas fa-download"></i></button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>P-0987</strong></td>
                            <td>Acute Myocardial Infarction</td>
                            <td><span class="icd-badge">I21.9</span></td>
                            <td><span class="confidence-badge high">97.8%</span></td>
                            <td>2024-01-15 13:18</td>
                            <td>
                                <button class="btn-table-action"><i class="fas fa-eye"></i></button>
                                <button class="btn-table-action"><i class="fas fa-download"></i></button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>P-0892</strong></td>
                            <td>Ischemic Stroke</td>
                            <td><span class="icd-badge">I63.9</span></td>
                            <td><span class="confidence-badge high">96.2%</span></td>
                            <td>2024-01-15 12:45</td>
                            <td>
                                <button class="btn-table-action"><i class="fas fa-eye"></i></button>
                                <button class="btn-table-action"><i class="fas fa-download"></i></button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>P-0765</strong></td>
                            <td>Acute Appendicitis</td>
                            <td><span class="icd-badge">K35.80</span></td>
                            <td><span class="confidence-badge medium">88.5%</span></td>
                            <td>2024-01-15 11:22</td>
                            <td>
                                <button class="btn-table-action"><i class="fas fa-eye"></i></button>
                                <button class="btn-table-action"><i class="fas fa-download"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Analyzing with AI... Please wait</p>
    </div>

    <!-- Scripts -->
    <script src="../static/js/dashboard.js"></script>
    <script src="../static/js/diagnosis.js"></script>
    <script src="../static/js/i18n.js"></script>

    <!-- Logic Modal -->
    <div class="modal-overlay" id="logicModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
        <div class="logic-modal" style="background: linear-gradient(135deg, #131318 0%, #1a1a2e 100%); border: 2px solid rgba(255,0,51,0.3); border-radius: 20px; max-width: 800px; width: 90%; max-height: 85vh; overflow-y: auto; padding: 40px; position: relative;">
            <button class="modal-close" id="modalClose" style="position: absolute; top: 20px; right: 20px; background: rgba(255,0,51,0.1); border: 2px solid rgba(255,0,51,0.3); color: #ff0033; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                <i class="fas fa-times"></i>
            </button>

            <div class="modal-header" style="margin-bottom: 30px;">
                <h2 style="color: #ff0033; font-size: 28px; margin-bottom: 10px;" data-tr="Tanı Asistanı Çalışma Mantığı" data-en="Diagnosis Assistant Working Logic">Tanı Asistanı Çalışma Mantığı</h2>
                <p style="color: rgba(255,255,255,0.7); font-size: 14px;" data-tr="AI destekli tanı sistemi nasıl çalışır" data-en="How the AI-powered diagnosis system works">AI destekli tanı sistemi nasıl çalışır</p>
            </div>

            <div class="modal-content">
                <div class="logic-section" style="margin-bottom: 25px;">
                    <h3 style="color: #fff; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-brain" style="color: #ff0033;"></i>
                        <span data-tr="Semptom Analizi" data-en="Symptom Analysis">Semptom Analizi</span>
                    </h3>
                    <p style="color: rgba(255,255,255,0.8); line-height: 1.6; margin-bottom: 10px;" data-tr="Sistem, hasta semptomlarını analiz eder ve geniş bir tıbbi veri tabanı ile karşılaştırır. AI modeli, semptomların şiddetini, süresini ve ilişkilerini değerlendirerek olası tanıları belirlenir." data-en="The system analyzes patient symptoms and compares them with an extensive medical database. The AI model evaluates symptom severity, duration, and relationships to identify possible diagnoses.">Sistem, hasta semptomlarını analiz eder ve geniş bir tıbbi veri tabanı ile karşılaştırır. AI modeli, semptomların şiddetini, süresini ve ilişkilerini değerlendirerek olası tanıları belirlenir.</p>
                </div>

                <div class="logic-section" style="margin-bottom: 25px;">
                    <h3 style="color: #fff; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-microscope" style="color: #ff0033;"></i>
                        <span data-tr="Diferansiyel Tanı" data-en="Differential Diagnosis">Diferansiyel Tanı</span>
                    </h3>
                    <p style="color: rgba(255,255,255,0.8); line-height: 1.6; margin-bottom: 10px;" data-tr="AI, benzer semptomları olan hastalıkları sıralayarak diferansiyel tanı listesi oluşturur. Her tanı için olasılık skoru ve destekleyici bulgular sunulur." data-en="The AI creates a differential diagnosis list by ranking diseases with similar symptoms. Probability scores and supporting findings are provided for each diagnosis.">AI, benzer semptomları olan hastalıkları sıralayarak diferansiyel tanı listesi oluşturur. Her tanı için olasılık skoru ve destekleyici bulgular sunulur.</p>
                </div>

                <div class="logic-section" style="margin-bottom: 25px;">
                    <h3 style="color: #fff; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-vial" style="color: #ff0033;"></i>
                        <span data-tr="Test Önerileri" data-en="Test Recommendations">Test Önerileri</span>
                    </h3>
                    <p style="color: rgba(255,255,255,0.8); line-height: 1.6; margin-bottom: 10px;" data-tr="Sistem, tanıyı doğrulamak için gerekli laboratuvar testlerini, görüntüleme yöntemlerini ve diğer tetkikleri önerir. Öncelik sırasına göre sıralanmış test listesi sunulur." data-en="The system recommends necessary laboratory tests, imaging methods, and other examinations to confirm the diagnosis. A prioritized list of tests is provided.">Sistem, tanıyı doğrulamak için gerekli laboratuvar testlerini, görüntüleme yöntemlerini ve diğer tetkikleri önerir. Öncelik sırasına göre sıralanmış test listesi sunulur.</p>
                </div>

                <div class="highlight-box" style="background: rgba(255,0,51,0.1); border: 2px solid rgba(255,0,51,0.3); border-radius: 10px; padding: 20px; margin-top: 20px;">
                    <p style="color: #fff; margin: 0; line-height: 1.6;" data-tr="Tüm AI önerileri bilimsel kanıtlara dayanır ve sürekli güncellenen tıbbi literatürden beslenir. Sistem, nadir hastalıkları da dahil ederek kapsamlı bir değerlendirme sunar." data-en="All AI recommendations are based on scientific evidence and fed by continuously updated medical literature. The system provides comprehensive evaluation including rare diseases.">Tüm AI önerileri bilimsel kanıtlara dayanır ve sürekli güncellenen tıbbi literatürden beslenir. Sistem, nadir hastalıkları da dahil ederek kapsamlı bir değerlendirme sunar.</p>
                </div>
            </div>
        </div>
    </div>


    <script>
        // Language Switcher
        const langBtns = document.querySelectorAll('.lang-btn');
        let currentLang = localStorage.getItem('preferred-language') || 'tr';

        // Set initial language
        langBtns.forEach(btn => {
            if (btn.getAttribute('data-lang') === currentLang) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });

        // Apply initial language
        if (currentLang === 'en') {
            document.querySelectorAll('[data-tr]').forEach(el => {
                const enText = el.getAttribute('data-en');
                if (el.tagName === 'P' || el.tagName === 'STRONG' || el.tagName === 'SPAN') {
                    if (enText && enText.includes('<strong>')) {
                        el.innerHTML = enText;
                    } else if (enText) {
                        el.textContent = enText;
                    }
                } else if (enText) {
                    el.textContent = enText;
                }
            });
        }

        langBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const lang = btn.getAttribute('data-lang');
                currentLang = lang;

                langBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                document.querySelectorAll('[data-tr]').forEach(el => {
                    const trText = el.getAttribute('data-tr');
                    const enText = el.getAttribute('data-en');

                    if (el.tagName === 'P' || el.tagName === 'STRONG' || el.tagName === 'SPAN') {
                        const text = lang === 'tr' ? trText : enText;
                        if (text && text.includes('<strong>')) {
                            el.innerHTML = text;
                        } else if (text) {
                            el.textContent = text;
                        }
                    } else if (enText && trText) {
                        el.textContent = lang === 'tr' ? trText : enText;
                    }
                });

                localStorage.setItem('preferred-language', lang);
            });
        });

        // Logic Modal Controls
        const logicBtn = document.getElementById('logicBtn');
        const logicModal = document.getElementById('logicModal');
        const modalClose = document.getElementById('modalClose');

        logicBtn?.addEventListener('click', () => {
            logicModal.style.display = 'flex';
        });

        modalClose?.addEventListener('click', () => {
            logicModal.style.display = 'none';
        });

        logicModal?.addEventListener('click', (e) => {
            if (e.target === logicModal) {
                logicModal.style.display = 'none';
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && logicModal.style.display === 'flex') {
                logicModal.style.display = 'none';
            }
        });

        // Mobile Menu Toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebarClose');

        mobileMenuToggle?.addEventListener('click', () => {
            sidebar?.classList.toggle('active');
        });

        sidebarClose?.addEventListener('click', () => {
            sidebar?.classList.remove('active');
        });
    </script>
</body>
</html>
